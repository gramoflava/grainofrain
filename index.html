<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grain of Rain</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="stylesheet" href="./styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script type="module" src="./js/ui.js"></script>
</head>
<body>
  <main class="container-fluid">
    <header id="config-bar">
      <form id="controls" aria-label="Data configuration">
        <div class="controls-row">
          <select id="mode-selector" aria-label="Analysis mode">
            <option value="comparison">Overview</option>
            <option value="periodic">Periodic</option>
            <option value="progression">Progression</option>
          </select>

          <select id="smoothing-selector" aria-label="Smoothing">
            <option value="0">No smoothing</option>
            <option value="5">5 days</option>
            <option value="14">14 days</option>
          </select>

          <!-- Comparison Mode Controls -->
          <div id="controls-comparison" class="mode-controls">
            <div class="city-tags-container">
              <div id="city-tags" class="city-tags"></div>
              <div class="city-input-wrapper">
                <input
                  id="city-search"
                  class="city-search-input"
                  type="search"
                  name="search-location"
                  placeholder="Add city..."
                  autocomplete="off"
                  autocorrect="off"
                  autocapitalize="off"
                  spellcheck="false"
                  aria-autocomplete="list"
                  aria-expanded="false"
                />
                <button id="auto-location-btn" type="button" class="auto-location-btn" title="Auto-detect location">
                  <img src="icons/map-pin.svg" alt="Auto-detect" width="18" height="18">
                </button>
                <div id="city-dropdown" class="city-dropdown" role="listbox"></div>
              </div>
            </div>

            <input id="start" type="date" />
            <input id="end" type="date" />
          </div>

          <!-- Periodic Mode Controls -->
          <div id="controls-periodic" class="mode-controls hidden">
            <div class="city-input-wrapper">
              <input
                id="periodic-city-search"
                class="city-search-input"
                type="search"
                placeholder="City"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                aria-autocomplete="list"
                aria-expanded="false"
              />
              <button id="auto-location-periodic-btn" type="button" class="auto-location-btn" title="Auto-detect location">
                <img src="icons/map-pin.svg" alt="Auto-detect" width="18" height="18">
              </button>
              <div id="periodic-city-dropdown" class="city-dropdown" role="listbox"></div>
            </div>

            <div class="year-tags-container">
              <div id="year-tags" class="year-tags"></div>
              <input
                id="year-input"
                class="year-input"
                type="number"
                placeholder="Add year..."
                min="1940"
                max="2100"
              />
            </div>

            <input id="period-start" type="text" placeholder="MM-DD start" pattern="\d{2}-\d{2}" />
            <input id="period-end" type="text" placeholder="MM-DD end" pattern="\d{2}-\d{2}" />
          </div>

          <!-- Progression Mode Controls -->
          <div id="controls-progression" class="mode-controls hidden">
            <div class="city-input-wrapper">
              <input
                id="progression-city-search"
                class="city-search-input"
                type="search"
                placeholder="City"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                aria-autocomplete="list"
                aria-expanded="false"
              />
              <button id="auto-location-progression-btn" type="button" class="auto-location-btn" title="Auto-detect location">
                <img src="icons/map-pin.svg" alt="Auto-detect" width="18" height="18">
              </button>
              <div id="progression-city-dropdown" class="city-dropdown" role="listbox"></div>
            </div>

            <select id="period-type">
              <option value="year">Whole year</option>
              <option value="season">Season</option>
              <option value="month">Month</option>
              <option value="day">Specific day</option>
            </select>

            <div id="period-config-container">
              <select id="season-select" style="width: 100px; display: none;">
                <option value="winter">Winter</option>
                <option value="spring">Spring</option>
                <option value="summer">Summer</option>
                <option value="fall">Fall</option>
              </select>

              <select id="month-select" style="width: 100px; display: none;">
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>

              <input id="day-select" type="text" placeholder="MM-DD" pattern="\d{2}-\d{2}" style="width: 100px; display: none;" />
            </div>

            <input id="year-from" type="number" placeholder="From year" min="1940" max="2100" style="width: 100px;" />
            <input id="year-to" type="number" placeholder="To year" min="1940" max="2100" style="width: 100px;" />
          </div>

          <div class="spacer"></div>

          <div class="action-buttons">
            <button id="copy" type="button" class="icon-btn" title="Copy charts">
              <img src="icons/copy.svg" alt="Copy" width="20" height="20">
            </button>
            <button id="download" type="button" class="icon-btn" title="Download charts">
              <img src="icons/download.svg" alt="Download" width="20" height="20">
            </button>
            <button id="reset" type="button" class="icon-btn danger" title="Reset app">
              <img src="icons/reset.svg" alt="Reset" width="20" height="20">
            </button>
          </div>

          <button id="apply" type="submit" class="primary">Apply</button>
        </div>
      </form>
    </header>

    <div id="workspace">
      <section id="charts" aria-label="Forecast charts">
        <div class="chart-card">
          <header>Temperature · Climate Norm · Wind</header>
          <div id="chart-temp" class="chart" role="img" aria-label="Temperature chart"></div>
        </div>
        <div class="chart-card">
          <header>Precipitation · Humidity</header>
          <div id="chart-hydro" class="chart" role="img" aria-label="Hydrology chart"></div>
        </div>
      </section>
      <aside id="panel">
        <section id="stats" aria-live="polite"></section>
      </aside>
    </div>

    <footer style="text-align: center; padding: 1rem; font-size: 0.75rem; color: var(--text-muted);">
      This is a pure vibe-coded app, <a href="about.html" style="color: var(--text-secondary); text-decoration: none; border-bottom: 1px dotted var(--text-muted);">read more here</a>
    </footer>
  </main>

  <!-- Ko-fi Donation Widget -->
  <div id="kofi-floater" class="kofi-floater">
    <img src="icons/coffee.svg" alt="Support" width="32" height="32">
  </div>

  <div id="kofi-panel" class="kofi-panel hidden">
    <iframe id='kofiframe' src='https://ko-fi.com/gramoflava/?hidefeed=true&widget=true&embed=true&preview=true' style='border:none;width:100%;padding:0;background:transparent;' height='660' title='gramoflava'></iframe>
  </div>

  <div id="kofi-close" class="kofi-floater hidden">
    <img src="icons/circle-x.svg" alt="Close" width="32" height="32">
  </div>

  <script>
    const floater = document.getElementById('kofi-floater');
    const panel = document.getElementById('kofi-panel');
    const closeBtn = document.getElementById('kofi-close');

    floater.addEventListener('click', () => {
      floater.classList.add('hidden');
      closeBtn.classList.remove('hidden');
      panel.classList.remove('hidden');
    });

    closeBtn.addEventListener('click', () => {
      panel.classList.add('hidden');
      closeBtn.classList.add('hidden');
      floater.classList.remove('hidden');
    });
  </script>
</body>
</html>
